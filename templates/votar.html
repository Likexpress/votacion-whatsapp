<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Elecciones Ciudadanas 2025</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        async function cargarPaises() {
            const res = await fetch("https://countriesnow.space/api/v0.1/countries");
            const data = await res.json();
            const paises = data.data;
            const selectPais = $('#pais');
            paises.forEach(p => {
                const option = new Option(p.country, p.country, false, false);
                selectPais.append(option);
            });
            selectPais.trigger('change');
            selectPais.on('change', function () {
                const paisSeleccionado = $(this).val();
                cargarCiudades(paisSeleccionado);
            });
        }

        async function cargarCiudades(pais) {
            const selectCiudad = $('#ciudad');
            selectCiudad.empty().append(new Option("Cargando...", "", false, false)).trigger('change');
            const res = await fetch("https://countriesnow.space/api/v0.1/countries/cities", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ country: pais })
            });
            const data = await res.json();
            selectCiudad.empty().append(new Option("Seleccione una ciudad", "", false, false));
            data.data.forEach(c => {
                const option = new Option(c, c, false, false);
                selectCiudad.append(option);
            });
            selectCiudad.trigger('change');
        }

        function obtenerGeolocalizacion() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    document.getElementById('latitud').value = position.coords.latitude;
                    document.getElementById('longitud').value = position.coords.longitude;
                }, function(error) {
                    console.warn("No se pudo obtener la ubicación: ", error.message);
                });
            }
        }

        $(document).ready(function () {
            $('#pais').select2({ placeholder: "Seleccione un país", width: '100%' });
            $('#ciudad').select2({ placeholder: "Seleccione una ciudad", width: '100%' });
            cargarPaises();
            obtenerGeolocalizacion();
        });
    </script>
</head>
<body class="container mt-5">
    <h2 class="mb-4">Elecciones Ciudadanas 2025</h2>
    <form method="post" action="/enviar_voto">
        <input type="hidden" name="numero" value="{{ numero }}">
        <input type="hidden" id="latitud" name="latitud">
        <input type="hidden" id="longitud" name="longitud">

        <div class="mb-3">
            <label for="ci" class="form-label">Número de Carnet de Identidad:</label>
            <input type="number" id="ci" name="ci" class="form-control" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Fecha de nacimiento:</label>
            <div class="row">
                <div class="col">
                    <select class="form-select" name="dia_nacimiento" required>
                        <option value="">Día</option>
                        {% for dia in range(1, 32) %}
                        <option value="{{ dia }}">{{ dia }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col">
                    <select class="form-select" name="mes_nacimiento" required>
                        <option value="">Mes</option>
                        <option value="1">Enero</option>
                        <option value="2">Febrero</option>
                        <option value="3">Marzo</option>
                        <option value="4">Abril</option>
                        <option value="5">Mayo</option>
                        <option value="6">Junio</option>
                        <option value="7">Julio</option>
                        <option value="8">Agosto</option>
                        <option value="9">Septiembre</option>
                        <option value="10">Octubre</option>
                        <option value="11">Noviembre</option>
                        <option value="12">Diciembre</option>
                    </select>
                </div>
                <div class="col">
                    <select class="form-select" name="anio_nacimiento" required>
                        <option value="">Año</option>
                        {% for anio in range(1940, 2024) %}
                        <option value="{{ anio }}">{{ anio }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label for="pais" class="form-label">País:</label>
            <select id="pais" name="pais" class="form-select" required>
                <option></option>
            </select>
        </div>

        <div class="mb-3">
            <label for="ciudad" class="form-label">Ciudad:</label>
            <select id="ciudad" name="ciudad" class="form-select" required>
                <option></option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Elige tu candidato:</label>
            {% for candidato in [
                'Amparo Ballivian', 'Chi Hyun Chung', 'Edgar Uriona',
                'Edmar Lara', 'Jaime Dunn', 'Jorge Quiroga Ramirez',
                'José Carlos Sánchez', 'Manfred Reyes Villa',
                'Rodrigo Paz Pereira', 'Samuel Doria Medina'] %}
            <div class="form-check">
                <input class="form-check-input" type="radio" name="candidato" value="{{ candidato }}" required>
                <label class="form-check-label">{{ candidato }}</label>
            </div>
            {% endfor %}
        </div>

        <button type="submit" class="btn btn-primary">Votar</button>
    </form>
</body>
</html>
